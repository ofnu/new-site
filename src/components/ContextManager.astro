---
import { ViewTransitions } from 'astro:transitions';
import ProjectsContext from './contexts/ProjectsContext.astro';
import GalleryContext from './contexts/GalleryContext.astro';
---

<div class="context-manager">
  <div class="snap-container" id="snap-container">
    <div class="context" id="projects">
      <ProjectsContext />
    </div>
    
    <div class="context" id="main">
      <slot />
    </div>
    
    <div class="context" id="gallery">
      <GalleryContext />
    </div>
  </div>

  <div class="scroll-indicator">
    <div class="chevron"></div>
  </div>
</div>

<style>
  .context-manager {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    overflow: hidden;
  }

  .snap-container {
    height: 100vh;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
  }

  .context {
    height: 100vh;
    width: 100%;
    scroll-snap-align: center;
    scroll-snap-stop: always;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Hide scrollbar for Chrome, Safari and Opera */
  .snap-container::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  .snap-container {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

  .scroll-indicator {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  .chevron {
    width: 20px;
    height: 20px;
    border-style: solid;
    border-width: 0.25em 0.25em 0 0;
    transform: rotate(135deg);
    border-color: rgba(255, 255, 255, 0.8);
    animation: bounce 2s infinite;
  }

  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0) rotate(135deg);
    }
    40% {
      transform: translateY(-10px) rotate(135deg);
    }
    60% {
      transform: translateY(-5px) rotate(135deg);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .snap-container {
      scroll-behavior: auto;
    }
    .chevron {
      animation: none;
    }
  }
</style>

<script>
  // Center the view on the main context on load
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.snap-container');
    const mainContext = document.querySelector('#main');
    
    if (container && mainContext) {
      // Scroll to the main context
      mainContext.scrollIntoView({ behavior: 'instant' });
      
      // Optional: Hide scroll indicator after first scroll
      const indicator = document.querySelector('.scroll-indicator');
      if (indicator) {
        let scrollTimeout: number;
        container.addEventListener('scroll', () => {
          indicator.classList.add('fade-out');
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => {
            indicator.classList.remove('fade-out');
          }, 1000);
        });
      }
    }
  });

  // Handle reload/refresh to maintain position on main context
  window.addEventListener('beforeunload', () => {
    const mainContext = document.querySelector('#main');
    if (mainContext) {
      mainContext.scrollIntoView({ behavior: 'instant' });
    }
  });
</script>