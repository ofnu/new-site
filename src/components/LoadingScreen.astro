---
// src/components/LoadingScreen.astro
---
<div id="loading-screen">
  <div id="demo"></div>
</div>

<link rel="stylesheet" href="/node_modules/asciinema-player/dist/bundle/asciinema-player.css" />
<script is:inline src="/node_modules/asciinema-player/dist/bundle/asciinema-player.min.js"></script>

<script>
  function handleFirstVisit() {
    const loadingScreen = document.getElementById('loading-screen');
    const hasVisited = sessionStorage.getItem('hasVisited');
    
    if (!hasVisited) {
      document.body.style.overflow = 'hidden';
      
      if (typeof AsciinemaPlayer === 'undefined') return;

      const player = AsciinemaPlayer.create(
        '/assets/knockknock.cast',
        document.getElementById('demo'),
        {
          autoPlay: true,
          cols: 176,
          rows: 80,
          fit: 'width',
          controls: false,
          markers: false
        }
      );

      player.addEventListener('ended', () => {
        loadingScreen.classList.add('fade-out');
        setTimeout(() => {
          loadingScreen.style.display = 'none';
          sessionStorage.setItem('hasVisited', 'true');
          document.body.style.overflow = 'auto';
        }, 500);
      });

      setTimeout(() => {
        if (loadingScreen.style.display !== 'none') {
          loadingScreen.classList.add('fade-out');
          setTimeout(() => {
            loadingScreen.style.display = 'none';
            sessionStorage.setItem('hasVisited', 'true');
            document.body.style.overflow = 'auto';
          }, 500);
        }
      }, 10000);

    } else {
      loadingScreen.style.display = 'none';
    }
  }

  document.addEventListener('DOMContentLoaded', handleFirstVisit);
</script>

<style>
  #loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #121314;
    z-index: 9999;
    /* Flexbox approach */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #demo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* Force to center */
    width: 60%;
  }

  #loading-screen.fade-out {
    opacity: 0;
    transition: opacity 0.5s ease-out;
  }

  :global(.asciinema-player) {
    width: 100% !important;
  }

  :global(.asciinema-terminal) {
    padding: 0 !important;
    border: none !important;
    background: transparent !important;
  }

  :global(.asciinema-player-wrapper) {
    padding: 0 !important;
  }

  @media (max-width: 768px) {
    #demo {
      width: 80%;
    }
  }
</style>